<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="Resource/css/demo.css" />
		<link rel="stylesheet" href="Resource/css/vant.css">
		<link rel="stylesheet" href="Resource/css/cash_order.css" />
		<title>消费订单</title>
		<style>
			.container {
				height: 100%;
				background: rgb(251,251,251);
			}
			
			.warn {
				display: flex;
				flex-direction: column;
				width: 100%;
				flex:1;
				align-items: center;
				justify-content: center;
			}
			
			.warn img {
				width: 120px;
				height: 120px;
			}
			
			.warn span {
				font-size: 12px;
				color: rgb(70,155,150);
			}
		</style>
	</head>

	<body>
		<div id="app" class="container" v-cloak>
			<van-list v-model="loading" :finished="finished" finished-text="没有更多了" @load="onLoad">
				<van-pull-refresh v-model="isLoading" @refresh="onRefresh">
					<div class="list">
						<div class="list_item" v-for="v in list">
							<div class="list_img">
								<img :src="v.shopIcon" alt="" />
							</div>
							<div class="list_content">
								<h3>{{v.shopName}}</h3>
								<div class="list_address">
									<span>{{v.adtime}}</span>
								</div>
							</div>
							<div class="voucher">{{v.amount}}</div>
						</div>
					</div>
				</van-pull-refresh>
			</van-list>
			<div class="warn" v-if="onOff">
				<img src="Resource/images/data.png" alt="">
				<span>还没有您的消费订单呦~</span>
			</div>
		</div>

		<script src="Resource/js/flexible.js"></script>
		<script src="Resource/js/vue.min.js"></script>
		<script src="Resource/js/vant.js"></script>
		<script src="Resource/js/jquery.min.js"></script>
		<script src="Resource/js/common.js"></script>
		<script>
			var app = new Vue({
				el: "#app",
				data: {
					isLoading: false,
					list: [],
					loading: false,
					finished: false,
					page: 1,
					totalPage: 10,
					onOff: false
				},
				methods: {
					onRefresh: function() {
						var self = this
						this.list = [];
						this.page = 1;
						this.totalPage = 10;
						this.onLoad();
						setTimeout(function() {
							self.$toast('刷新成功');
							self.isLoading = false;
						}, 500);
					},
					onLoad: function() {
						//注意在此处的滚动加载必须产生滚动条所以多加载几条数据
						if (this.page <= this.totalPage) {
							var datas = {
								uid: uid,
								page: this.page
							}
							queryData('/orderList', datas, this.successLoad);
							this.page++;
							// 加载状态结束
							this.loading = false;
						} else {
							this.loading = false;
							this.finished = true;
						}
					},
					successLoad: function(res) {
						if (res.result == 0) {
							this.totalPage = res.totalPage;
							if (res.dataList == undefined || res.dataList.length == 0) {
								this.onOff = true;
							} else if (res.dataList.length > 0) {
								this.onOff = false;
								for (var i = 0; i < res.dataList.length; i++) {
									this.list.push(res.dataList[i]);
								}
							}
							return this.list;
						}
					}
				}
			})
		</script>
	</body>

</html>
