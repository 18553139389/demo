<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>一周食谱</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<link rel="stylesheet" href="css/demo.css" />
		<link rel="stylesheet" href="css/photoswipe.css" />
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/food.css" />
	</head>

	<body>
		<div id="app" class="list" v-cloak>
			<div class="navTop">
				一周食谱
				<img class="back" src="./images/back_top.png" @tap="goBack" />
			</div>
			<ul class="food_wrapper">
				<li v-for="v in list" @tap="goDetail(v.detailurl)">
					<img preview="0" v-lazy="v.image" alt="" />
					<div class="food_text">
						<h3 v-if="v.week == 1">星期一</h3>
						<h3 v-if="v.week == 2">星期二</h3>
						<h3 v-if="v.week == 3">星期三</h3>
						<h3 v-if="v.week == 4">星期四</h3>
						<h3 v-if="v.week == 5">星期五</h3>
						<span>{{v.title}}</span>
					</div>
				</li>
			</ul>
		</div>
		<script src="js/flexible.js"></script>
		<script src="js/jquery.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/lazyload.js"></script>
		<script src="js/photoswipe.js"></script>
		<script src="js/common.js"></script>
		<script src="js/app.js"></script>
		<script>
			//实现图片的懒加载方法
			Vue.use(VueLazyload, {
				loading: "./images/60x60.gif",
				listenEvents: ['scroll']
			});
			//实现图片预览放大功能
			var options = {
				fullscreenEl: false
			}
			Vue.use(vuePhotoPreview, options);
			var food = new Vue({
				el: "#app",
				data: {
					list: []
				},
				mounted: function() {
					this.onLoad();
				},
				methods: {
					goBack: function() {
						window.history.go(-1);
					},
					onLoad: function() {
						var that = this;
						var id = setInterval(function() {
							var state = app.getState();
							var uid = state.uid;
							if(uid == undefined) {
								return
							} else {
								clearInterval(id);
								var datas = {
									cmd: "weekRecipes",
									uid: uid,
								}
								ajax(datas, that.successLoad);
							}
						}, 400);
					},
					successLoad: function(res) {
						if(res.result == 0) {
							this.list = res.dataList.sort(compare);
						}
						food.$previewRefresh();
					}
				}
			});
			mui.init();
			//时间排序方法
			function compare(obj1, obj2) {
				var val1 = obj1.week;  
				var val2 = obj2.week;  
				if(val1 > val2) {    
					return 1;  
				} else if(val1 < val2) {    
					return -1;  
				} else {    
					return 0;  
				}
			}

			function goDetail(url) {
				window.location.href = "./food_detail.html?url=" + url;
			}
		</script>
	</body>

</html>