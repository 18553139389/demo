<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>修改密码</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<link rel="stylesheet" href="css/demo.css" />
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/modify_pass.css" />
	</head>

	<body>
		<div class="list">
			<div class="navTop">
				更改密码
				<img id="back" class="back" src="./images/back_top.png" alt="" />
			</div>
			<div class="loginForm">
				<input id="oldPass" type="password" placeholder="请输入原密码" />
				<input id="newPass1" type="password" placeholder="请输入新密码" />
				<input id="newPass2" type="password" placeholder="请再次输入新密码" />
				<div id="btn">完成</div>
			</div>
		</div>

		<script src="js/flexible.js"></script>
		<script src="js/jquery.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/common.js"></script>
		<script src="js/app.js"></script>
		<script src="js/md5.js"></script>
		<script>
			mui.init();
			document.getElementById('back').addEventListener('tap', function() {
				window.history.go(-1);
			});
			document.getElementById('btn').addEventListener('tap', function() {
				var state = app.getState();
				var uid = state.uid;
				var pass = state.pass;
				var old = document.getElementById('oldPass').value;
				var pass1 = document.getElementById('newPass1').value;
				var pass2 = document.getElementById('newPass2').value;
				if(old == '' || pass1 == '' || pass2 == '') {
					mui.toast("密码不能为空");
					return;
				}
				if(hex_md5(old) != pass) {
					mui.toast("原密码不正确");
					return;
				}
				if(pass1 != pass2) {
					mui.toast("两次密码输入不一致");
					return;
				}
				if(pass1.length < 6) {
					mui.toast("密码长度必须大于等于6位");
					return;
				}
				var datas = {
					cmd: "editUserPassword",
					uid: uid,
					oldPassword: hex_md5(old),
					newPassword: hex_md5(pass1)
				}
				ajax(datas, successLoad);
			});

			function successLoad(res) {
				if(res.result == 0) {
					mui.toast("修改成功");
					document.getElementById('oldPass').value = '';
					document.getElementById('newPass1').value = '';
					document.getElementById('newPass2').value = '';
					setTimeout(function() {
						window.history.go(-1);
					}, 800);
				}
			}
		</script>
	</body>

</html>