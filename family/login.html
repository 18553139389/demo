<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>登录</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<link rel="stylesheet" href="css/demo.css" />
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/vant.css">
		<link rel="stylesheet" href="css/login.css" />
	</head>

	<body>
		<div id="app" class="list" v-cloak>
			<div class="logo">
				<img src="images/logo.png" alt="" />
			</div>
			<div class="loginForm">
				<input id="phone" type="text" placeholder="请输入手机号" v-model="phone" />
				<input id="pass" type="password" placeholder="请输入密码" v-model="pass" />
				<span id="forget" @tap="goForget">忘记密码？</span>
				<div id="btn" @tap="submit">登录</div>
			</div>
		</div>

		<script src="js/flexible.js"></script>
		<script src="js/jquery.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/vant.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/common.js"></script>
		<script src="js/app.js"></script>
		<script src="js/md5.js"></script>
		<script>
			var login = new Vue({
				el: "#app",
				data: {
					phone: '',
					pass: ''
				},
				methods: {
					submit: function() {
						if (this.phone == '' || this.pass == '') {
							this.$toast("账号或密码不能为空");
							return;
						}

						if (!(/^1[34578]\d{9}$/.test(this.phone))) {
							this.$toast("手机号码格式不正确");
							return;
						}

						if (this.pass.length < 6) {
							this.$toast("密码长度必须大于等于6位");
							return;
						}

						var that = this;
						var loginInfo = {
							cmd: "userLogin",
							phone: this.phone,
							password: hex_md5(this.pass)
						};

						ajax(loginInfo, function(res) {
							if (res.result == 0) {
								that.$toast("登陆成功");
								app.login(res.dataobject, hex_md5(that.pass));
								setTimeout(function() {
									window.location.href = "first.html";
								}, 1500);
							} else if(res.result == 1){
								that.$toast(res.resultNote);
							}
						});
					},
					goForget: function() {
						window.location.href = "./forget.html"
					}
				}
			});
		</script>
	</body>

</html>
