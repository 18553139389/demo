<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>忘记密码</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<link rel="stylesheet" href="css/demo.css" />
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/forget.css" />
	</head>

	<body>
		<div class="list">
			<div class="navTop">
				忘记密码
				<img id="back" class="back" src="./images/back_top.png"/>
			</div>
			<div class="loginForm">
				<input id="phone" type="number" placeholder="请输入手机号" />
				<div class="box">
					<input id="code" type="number" placeholder="请输入验证码" />
					<button class="send" id="send">发送验证码</button>
				</div>
				<input id="pass1" type="password" placeholder="请输入新密码" />
				<input id="pass2" type="password" placeholder="请再次输入新密码" />
				<div id="btn">完成</div>
			</div>
		</div>

		<script src="js/flexible.js"></script>
		<script src="js/jquery.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/common.js"></script>
		<script src="js/app.js"></script>
		<script src="js/md5.js"></script>
		<script>
			document.getElementById('back').addEventListener('tap', function() {
				window.history.go(-1);
			});
			//忘记密码提交
			document.getElementById('btn').addEventListener('tap', function() {
				var phone = document.getElementById('phone').value;
				var code = document.getElementById('code').value;
				var pass1 = document.getElementById('pass1').value;
				var pass2 = document.getElementById('pass2').value;
				if(phone == '' || code == '') {
					mui.toast("手机号或验证码不能为空");
					return;
				}

				if(!(/^1[34578]\d{9}$/.test(phone))) {
					mui.toast("手机号码格式不正确");
					return;
				}

				if(pass1 == '' || pass2 == '') {
					mui.toast("密码不能为空");
					return;
				}

				if(pass1 != pass2) {
					mui.toast("两次密码输入不一致");
					return;
				}

				if(code != yanzheng) {
					mui.toast("验证码错误");
					return;
				}
				var datas = {
					cmd: "findUserPassword",
					phone: phone,
					password: hex_md5(pass1)
				}
				ajax(datas, successLoad);
			});

			function successLoad(res) {
				if(res.result == 0) {
					mui.toast("修改成功");
					document.getElementById('code').value = '';
					document.getElementById('phone').value = '';
					document.getElementById('pass1').value = '';
					document.getElementById('pass2').value = '';
					setTimeout(function() {
						window.history.go(-1);
					}, 800);
				}
			}

			//发送验证码
			var yanzheng;
			var send = document.getElementById('send');
			send.addEventListener('tap', function() {
				var phone = document.getElementById('phone').value;
				var code = document.getElementById('code').value;
				var datas = {
					cmd: "sendcode",
					phone: phone
				}
				ajax(datas, successSend);
				settime(send);
			});

			function successSend(res) {
				if(res.result == 0) {
					yanzheng = res.dataobject;
				}
			}
		</script>
	</body>

</html>