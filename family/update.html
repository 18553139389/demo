<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>版本更新</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<link rel="stylesheet" href="css/demo.css" />
		<link rel="stylesheet" href="css/vant.css">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/update.css" />
	</head>

	<body>
		<div id="app" class="list" v-cloak>
			<div class="navTop">
				版本更新
				<img class="back" src="./images/back_top.png" @tap="goBack" />
			</div>
			<img src="./images/logo.png" alt="" />
			<p>版本号{{version}}</p>
			<div class="list_item">
				<span>检测更新</span>
				<span id="update" style="color: #19B8EF;" @tap="update">版本号{{newVersion}}</span>
			</div>
		</div>

		<script src="js/flexible.js"></script>
		<script src="js/jquery.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/vant.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/common.js"></script>
		<script src="js/app.js"></script>
		<script>
			(function() {
				var set = new Vue({
					el: "#app",
					data: {
						version: '1.0',
						newVersion: ''
					},
					mounted: function() {
						this.onLoad();
					},
					methods: {
						onLoad: function() {
							var that = this;
							var datas = {
								cmd: "getversion",
								type: 1
							}
							ajax(datas, this.successLoad);
						},
						successLoad: function(res) {
							if(res.result == 0) {
								this.newVersion = res.versionNumber;
							}
						},
						goBack: function() {
							window.history.go(-1);
						},
						update: function() {
							if(this.newVersion == this.version) {
								mui.toast('已是最新版本');
								return;
							}
							var datas = {
								cmd: "getversion",
								type: 1
							}
							ajax(datas, this.successVersion);
						},
						successVersion: function(res) {
							if(res.result == 0) {
								this.$dialog.confirm({
									title: '版本',
									message: '是否要更新版本'
								}).then(() => {
									window.location.href = res.updataAddress;
								}).catch(() => {
									return;
								});
							} else {
								mui.toast('已是最新版本');
							}
						}
					}
				});
				mui.init();
			})();
		</script>
	</body>

</html>