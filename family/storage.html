<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>清除缓存</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<link rel="stylesheet" href="css/demo.css" />
		<link rel="stylesheet" href="css/vant.css">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/storage.css" />
	</head>

	<body>
		<div id="app" class="list" v-cloak>
			<div class="navTop">
				系统缓存
				<img class="back" src="./images/back_top.png" @tap="goBack" />
			</div>
			<h3>{{size_m}} KB</h3>
			<div class="used">已用空间</div>
			<button id="btn" type="button" @tap="clear">清除缓存</button>
		</div>

		<script src="js/flexible.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/vue.js"></script>
		<script src="js/vant.js"></script>
		<script src='js/app.js'></script>
		<script src="js/md5.js"></script>
		<script>
			var store = new Vue({
				el: "#app",
				data: {
					size_m: 0,
					uid: '',
					pass: ''
				},
				mounted: function() {
					if(!window.localStorage) {
						mui.toast('您的浏览器版本过低');
						return;
					}
					for(item in window.localStorage) {
						if(window.localStorage.hasOwnProperty(item)) {
							this.size_m += window.localStorage.getItem(item).length;
						}
					}
					var state = app.getState();
					this.uid = state.uid;
					this.pass = state.pass;
				},
				methods: {
					goBack: function() {
						window.history.go(-1);
					},
					clear: function() {
						var that = this;
						this.$dialog.confirm({
							title: '缓存',
							message: '确定清除缓存吗'
						}).then(() => {
							localStorage.clear();
							that.size_m = 0;
							app.login(that.uid, hex_md5(that.pass));
							mui.toast('缓存清除成功');
						}).catch(() => {
							return;
						});
					}
				}
			});
			mui.init();
		</script>
	</body>

</html>